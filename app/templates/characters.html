{% extends "base.html" %}

{% block title %}{{ t.nav_characters if t.nav_characters else "Character Guide" }} - {{ t.app_name }}{% endblock %}

{% block content %}
<div class="container mx-auto px-6 py-12">
    <!-- Header -->
    <div class="text-center mb-12">
        <h1 class="font-mythical text-4xl text-gold mb-4">
            {{ t.characters_title if t.characters_title else "Mythical Character Guide" }}
        </h1>
        <p class="text-gray-400 text-lg">
            {{ (t.characters_subtitle if t.characters_subtitle else "Explore {count} mythological figures from around the world") | replace("{count}", total_count|string) }}
        </p>
    </div>

    <!-- Category Filter -->
    <div class="mb-12">
        <div class="flex flex-wrap justify-center gap-2">
            <a href="/characters"
               class="px-4 py-2 rounded-full transition-colors {{ 'bg-gold text-black font-semibold' if not selected_category else 'border border-gold/50 text-gold hover:bg-gold/10' }}">
                {{ t.characters_all if t.characters_all else "All" }}
                <span class="text-xs ml-1 opacity-70">({{ total_count }})</span>
            </a>
            {% for cat in categories %}
            <a href="/characters?category={{ cat.value }}"
               class="px-4 py-2 rounded-full transition-colors {{ 'bg-gold text-black font-semibold' if selected_category == cat.value else 'border border-gold/50 text-gold hover:bg-gold/10' }}">
                {{ t.cultures[cat.value] if t.cultures and cat.value in t.cultures else (cat.name_ko if lang == "ko" else cat.name_en) }}
                <span class="text-xs ml-1 opacity-70">({{ category_counts[cat.value] }})</span>
            </a>
            {% endfor %}
        </div>
    </div>

    <!-- Characters Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
        {% for char in characters %}
        <div class="card-mythical p-5 hover:glow-gold transition-all group">
            <!-- Character Icon/Avatar (í´ë¦­í•˜ë©´ í™•ëŒ€) -->
            <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-br from-gold/20 to-gold/5 border border-gold/30 overflow-hidden cursor-pointer hover:ring-2 hover:ring-gold/50 transition-all"
                 onclick="showImageModal('/static/images/gods/{{ char.id }}.png', '{{ char.name }}', '{{ char.tagline | e }}')">
                <img src="/static/images/gods/{{ char.id }}.png"
                     alt="{{ char.name }}"
                     class="w-full h-full object-cover"
                     onerror="this.style.display='none'; this.parentElement.innerHTML='<span class=\'flex items-center justify-center w-full h-full text-2xl font-mythical text-gold\'>{{ char.name[0] | upper }}</span>';">
            </div>

            <!-- Names (í´ë¦­í•˜ë©´ ìƒì„¸ íŽ˜ì´ì§€ë¡œ) -->
            <a href="/character/{{ char.id }}" class="block">
                <h3 class="font-mythical text-lg text-white group-hover:text-gold transition-colors text-center mb-1">
                    {{ char.name }}
                </h3>
                <p class="text-xs text-gray-500 text-center mb-3">
                    {{ char.name_alt }}
                </p>

                <!-- Tagline -->
                <p class="text-sm text-gray-400 text-center line-clamp-2">
                    {{ char.tagline }}
                </p>
            </a>

            <!-- Traits Preview -->
            <div class="mt-4 flex flex-wrap justify-center gap-1">
                {% for trait in char.traits[:3] %}
                <span class="text-xs px-2 py-1 rounded-full bg-white/5 text-gray-400">
                    {{ trait }}
                </span>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Image Modal -->
    <div id="imageModal" class="fixed inset-0 bg-black/90 flex items-center justify-center z-50 hidden" onclick="closeImageModal(event)">
        <div class="relative max-w-2xl w-full mx-4 p-4">
            <!-- Close Button -->
            <button onclick="closeImageModal()" class="absolute top-0 right-0 -mt-12 text-white/70 hover:text-white text-3xl font-light z-10">
                &times;
            </button>

            <!-- Image Container -->
            <div class="card-mythical p-4 text-center" onclick="event.stopPropagation()">
                <img id="modalImage" src="" alt="" class="max-w-full max-h-[60vh] mx-auto rounded-lg shadow-2xl">
                <h3 id="modalTitle" class="font-mythical text-2xl text-gold mt-4"></h3>
                <p id="modalTagline" class="text-gray-400 mt-2"></p>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    {% if not characters %}
    <div class="text-center text-gray-400 py-16">
        <div class="text-5xl mb-4">ðŸ“š</div>
        {{ t.characters_empty if t.characters_empty else "No characters found in this category." }}
    </div>
    {% endif %}

    <!-- Back to Home -->
    <div class="text-center mt-12">
        <a href="/" class="btn-mythical inline-block">
            âœ¨ {{ t.characters_find_match if t.characters_find_match else "Find My Match" }}
        </a>
    </div>
</div>

<!-- Scroll to Top Button -->
<button id="scrollTopBtn" onclick="scrollToTop()"
        class="fixed bottom-6 right-6 w-12 h-12 bg-gold/20 border border-gold/50 rounded-full text-gold hover:bg-gold/30 transition-all opacity-0 pointer-events-none z-40 flex items-center justify-center shadow-lg"
        title="Scroll to top">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
    </svg>
</button>

<style>
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>
{% endblock %}

{% block scripts %}
<script>
function showImageModal(imageSrc, title, tagline) {
    const modal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage');
    const modalTitle = document.getElementById('modalTitle');
    const modalTagline = document.getElementById('modalTagline');

    modalImage.src = imageSrc;
    modalImage.alt = title;
    modalTitle.textContent = title;
    modalTagline.textContent = tagline;

    modal.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
}

function closeImageModal(event) {
    if (event && event.target !== event.currentTarget) return;

    const modal = document.getElementById('imageModal');
    modal.classList.add('hidden');
    document.body.style.overflow = '';
}

// ESC í‚¤ë¡œ ë‹«ê¸°
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeImageModal();
    }
});

// Scroll to Top
function scrollToTop() {
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

window.addEventListener('scroll', function() {
    const scrollBtn = document.getElementById('scrollTopBtn');
    if (window.scrollY > 300) {
        scrollBtn.classList.remove('opacity-0', 'pointer-events-none');
        scrollBtn.classList.add('opacity-100');
    } else {
        scrollBtn.classList.add('opacity-0', 'pointer-events-none');
        scrollBtn.classList.remove('opacity-100');
    }
});
</script>
{% endblock %}
